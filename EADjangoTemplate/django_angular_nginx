sub_filter_once off;
sub_filter_types *;
sub_filter random-csp-nonce $request_id;

upstream django {
    # server unix:///path/to/your/mysite/mysite.sock; # for a file socket
    # server 127.0.0.1:8000; # for a web port socket (we'll use this first)
    server /tmp/app.sock; # # for a file socket
}

server {

    server_name  {{ nginx_settings["host_name"] }};
    keepalive_timeout 5;
    root {{ www_path }}/gui;

    location /api {
        uwsgi_pass  django;
        include     /etc/nginx/uwsgi_params; # the uwsgi_params file you installed
    }

    location /  {

        if (-f {{ www_path }}/maintenance_on.html) {
            return 503;
        }
        try_files $uri $uri/  /index.html;

    }

    location ~* \.php$ {
        deny all;
        return 444;
    }

    # Error pages.
    error_page 503 /maintenance_on.html;
    location = /maintenance_on.html {
        root {{ www_path }};
    }

    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

}
